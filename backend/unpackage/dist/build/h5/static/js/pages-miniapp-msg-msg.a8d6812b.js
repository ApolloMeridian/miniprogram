(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-miniapp-msg-msg"],{"0131":function(e,t,n){"use strict";n.r(t);var r=n("c6c1"),a=n.n(r);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"0d71":function(e,t,n){"use strict";n.r(t);var r=n("9136"),a=n("0131");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("313e");var i,s=n("f0c5"),l=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,"c2241560",null,!1,r["a"],i);t["default"]=l.exports},"1e5e":function(e,t,n){"use strict";n.r(t);var r=n("6045"),a=n.n(r);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"313e":function(e,t,n){"use strict";var r=n("6463"),a=n.n(r);a.a},"5ad4":function(e,t,n){var r=n("24fb");t=r(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */',""]),e.exports=t},6045:function(e,t,n){"use strict";n("a9e3"),n("e25e"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n("1218"),a={name:"uniDateformat",props:{date:{type:[Object,String,Number],default:function(){return Date.now()}},locale:{type:String,default:"zh"},threshold:{type:Array,default:function(){return[0,0]}},format:{type:String,default:"yyyy/MM/dd hh:mm:ss"},refreshRate:{type:[Number,String],default:0}},data:function(){return{refreshMark:0}},computed:{dateShow:function(){return this.refreshMark,(0,r.friendlyDate)(this.date,{locale:this.locale,threshold:this.threshold,format:this.format})}},watch:{refreshRate:{handler:function(){this.setAutoRefresh()},immediate:!0}},methods:{refresh:function(){this.refreshMark++},setAutoRefresh:function(){var e=this;clearInterval(this.refreshInterval),this.refreshRate&&(this.refreshInterval=setInterval((function(){e.refresh()}),parseInt(this.refreshRate)))}}};t.default=a},"63f4":function(e,t,n){"use strict";n.r(t);var r=n("f467"),a=n("1e5e");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var i,s=n("f0c5"),l=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,"d411a642",null,!1,r["a"],i);t["default"]=l.exports},6463:function(e,t,n){var r=n("5ad4");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("4f06").default;a("bd696b6c",r,!0,{sourceMap:!1,shadowMode:!1})},9136:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={uniDateformat:n("63f4").default},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"uni-header"},[n("v-uni-view",{staticClass:"uni-group"},[n("v-uni-view",{staticClass:"uni-title"},[e._v("消息列表")])],1),n("v-uni-view",{staticClass:"uni-group"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.dialogFormVisible=!0,e.form.title="",e.form.content=""}}},[e._v("发布新消息")])],1)],1),n("v-uni-view",{staticClass:"uni-container"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.table,expression:"loading.table"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{prop:"title",label:"标题"}}),n("el-table-column",{attrs:{prop:"content",label:"内容"}}),n("el-table-column",{attrs:{prop:"create_time",label:"发布时间"},scopedSlots:e._u([{key:"default",fn:function(e){return[n("i",{staticClass:"el-icon-time"}),n("span",{staticStyle:{"margin-left":"10px"}},[n("uni-dateformat",{attrs:{date:e.row.create_time,format:"yyyy年MM月dd日 hh:mm:ss"}})],1)]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),n("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除吗？"},on:{confirm:function(n){arguments[0]=n=e.$handleEvent(n),e.handleDelete(t.$index,t.row)}}},[n("el-button",{attrs:{slot:"reference",size:"mini",type:"danger",loading:e.loading.delete&&e.operateId==t.row._id},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],1),n("el-dialog",{attrs:{title:"系统消息",visible:e.dialogFormVisible},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.dialogFormVisible=t}}},[n("el-form",{attrs:{model:e.form}},[n("el-form-item",{attrs:{label:"标题","label-width":"80px"}},[n("el-input",{attrs:{placeholder:"请输入标题",autocomplete:"off"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),n("el-form-item",{attrs:{label:"内容","label-width":"80px"}},[n("el-input",{attrs:{type:"textarea",rows:10,placeholder:"请输入内容"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.dialogFormVisible=!1,e.operateId=null,e.loading.submit=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary",loading:e.loading.submit},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}},[e._v("确 定")])],1)],1)],1)},o=[]},c6c1:function(e,t,n){"use strict";(function(e){var r=n("4ea4");n("99af"),n("4160"),n("d81d"),n("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var a=r(n("1da1")),o=e.database().collection("tx-sysmsg"),i={data:function(){return{loading:{table:!1,delete:!1,submit:!1},tableData:[],operateId:null,dialogFormVisible:!1,form:{title:"",content:""}}},onLoad:function(){var e=this;return(0,a.default)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getData();case 2:case"end":return t.stop()}}),t)})))()},methods:{getData:function(){var e=this;return(0,a.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.loading.table=!0,t.next=4,o.get();case 4:n=t.sent,console.log("获取数据成功：",{resp:n}),e.tableData=n.result.data,e.loading.table=!1,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.log("获取数据失败：",{resp:resp});case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},handleEdit:function(e,t){var n=this;return(0,a.default)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:console.log(e,t),n.operateId=t._id,n.form.title=t.title,n.form.content=t.content,n.dialogFormVisible=!0;case 4:case"end":return r.stop()}}),r)})))()},sendMsg:function(t,n){var r=this;return(0,a.default)(regeneratorRuntime.mark((function a(){var o,i,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=r.$moment().format("YYYY年MM月DD日 hh:mm"),a.prev=1,a.next=4,e.database().collection("uni-id-users").where({wx_openid:{$exists:!0}}).field("wx_openid").get();case 4:return i=a.sent,s=i.result,console.log("获取用户列表成功：",{result:s}),console.log({docId:t,title:n}),l=s.data.map((function(e){return e.wx_openid["mp-weixin"]})),a.next=11,r.sendToAllUser(l,t,n,o);case 11:a.next=16;break;case 13:a.prev=13,a.t0=a["catch"](1),console.log("获取用户列表失败：",a.t0);case 16:case"end":return a.stop()}}),a,null,[[1,13]])})))()},sendToAllUser:function(t,n,r,o){var i=this;return(0,a.default)(regeneratorRuntime.mark((function s(){var l,c;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:l=t.length,c=null,t.forEach(function(){var t=(0,a.default)(regeneratorRuntime.mark((function t(a,s){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log({openid:a,index:s}),c=i.$loading({lock:!0,text:"正在发送用户通知 ".concat(s+1," / ").concat(l),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t.prev=2,t.next=5,e.callFunction({name:"sendSysMsg",data:{openid:a,docId:n,title:r,time:o}});case 5:t.sent,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](2),console.log("发送失败：",{openid:a},t.t0);case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e,n){return t.apply(this,arguments)}}()),c.close();case 4:case"end":return s.stop()}}),s)})))()},submit:function(){var e=this;return(0,a.default)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.loading.submit=!0,console.log(e.form),null==e.operateId){t.next=21;break}return t.prev=3,t.next=6,o.doc(e.operateId).update(e.form);case 6:return n=t.sent,console.log("更新成功：",{resp:n}),e.$message({message:"更新成功",type:"success"}),e.dialogFormVisible=!1,e.operateId=null,t.next=13,e.getData();case 13:t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](3),console.log("更新失败：",t.t0),e.$message.error("更新失败，请重新提交");case 19:t.next=39;break;case 21:return t.prev=21,t.next=24,o.add(e.form);case 24:return r=t.sent,console.log("发布成功：",{resp:r}),e.$message({message:"发布成功",type:"success"}),e.dialogFormVisible=!1,e.operateId=null,t.next=31,e.getData();case 31:return t.next=33,e.sendMsg(r.result.id,e.form.title);case 33:t.next=39;break;case 35:t.prev=35,t.t1=t["catch"](21),console.log("发布失败：",t.t1),e.$message.error("发布失败，请重新提交");case 39:e.loading.submit=!1;case 40:case"end":return t.stop()}}),t,null,[[3,15],[21,35]])})))()},handleDelete:function(e,t){var n=this;return(0,a.default)(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(e,t),n.loading.delete=!0,n.operateId=t._id,r.prev=3,r.next=6,o.doc(t._id).remove();case 6:return a=r.sent,console.log("删除成功：",{resp:a}),n.$message({message:"删除成功",type:"success"}),r.next=11,n.getData();case 11:r.next=17;break;case 13:r.prev=13,r.t0=r["catch"](3),console.log("删除失败：",r.t0),n.$message.error("删除失败");case 17:return r.prev=17,n.loading.delete=!1,n.operateId=null,r.finish(17);case 21:case"end":return r.stop()}}),r,null,[[3,13,17,21]])})))()}}};t.default=i}).call(this,n("a9ff")["default"])},f467:function(e,t,n){"use strict";var r;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-text",[e._v(e._s(e.dateShow))])},o=[]}}]);