(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/trip/edit"],{"0b76":function(e,t,r){"use strict";(function(e){r("8342");n(r("66fd"));var t=n(r("b417"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},"4fba":function(e,t,r){},"78da":function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n}));var n={uTag:function(){return r.e("node-modules/uview-ui/components/u-tag/u-tag").then(r.bind(null,"ccda"))},uIcon:function(){return r.e("node-modules/uview-ui/components/u-icon/u-icon").then(r.bind(null,"1e2a"))},uButton:function(){return r.e("node-modules/uview-ui/components/u-button/u-button").then(r.bind(null,"f9a8"))},uSearch:function(){return r.e("node-modules/uview-ui/components/u-search/u-search").then(r.bind(null,"8122"))},uForm:function(){return r.e("node-modules/uview-ui/components/u-form/u-form").then(r.bind(null,"7539"))},uFormItem:function(){return Promise.all([r.e("common/vendor"),r.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(r.bind(null,"4ae2"))},uInput:function(){return Promise.all([r.e("common/vendor"),r.e("node-modules/uview-ui/components/u-input/u-input")]).then(r.bind(null,"531f"))},uSelect:function(){return r.e("node-modules/uview-ui/components/u-select/u-select").then(r.bind(null,"97b9"))}},i=function(){var e=this,t=e.$createElement,r=(e._self._c,e.__map(e.currentTrip.record,(function(t,r){var n=e.__get_orig(t),i=e.getTimeFromRecord(t.start_markerId),o=e.getTimeFromRecord(t.end_markerId);return{$orig:n,m0:i,m1:o}})));e._isMounted||(e.e0=function(t){e.currentSelect="start_markerId"},e.e1=function(t){e.currentSelect="end_markerId"},e.e2=function(t){e.selectShow=!0,e.currentSelect="transportation"},e.e3=function(t){e.selectShow=!0,e.currentSelect="purpose"}),e.$mp.data=Object.assign({},{$root:{l0:r}})},o=[]},"8d3e":function(e,t,r){"use strict";var n=r("4fba"),i=r.n(n);i.a},b417:function(e,t,r){"use strict";r.r(t);var n=r("78da"),i=r("c677");for(var o in i)"default"!==o&&function(e){r.d(t,e,(function(){return i[e]}))}(o);r("8d3e");var u,a=r("f0c5"),c=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,"657ac97e",null,!1,n["a"],u);t["default"]=c.exports},bebf:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("a34a")),i=r("2f62");function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t,r,n,i,o,u){try{var a=e[o](u),c=a.value}catch(s){return void r(s)}a.done?t(c):Promise.resolve(c).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){u(o,n,i,a,c,"next",e)}function c(e){u(o,n,i,a,c,"throw",e)}a(void 0)}))}}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=null,m=["#3742fa","#ffa502","#ff6348","#2ed573","#2f3542","#993333"],h={data:function(){return{currentTrip:{},latitude:"",longitude:"",currentTripIndex:null,currentEdit:null,isEdit:!1,keyword:"",model:{start_markerId:null,end_markerId:null,transportation:"",purpose:""},rules:{start_markerId:{label:"路径起点",required:!0,message:"请选择路径起点",trigger:"change",type:"number"},end_markerId:{label:"路径终点",required:!0,message:"请选择路径终点",trigger:"change",type:"number"},transportation:{label:"出行方式",required:!0,message:"请选择出行方式",trigger:"change",type:"enum",enum:["公交车","步行","自行车","地铁","汽车","公交车","飞机","高铁"]},purpose:{label:"出行目的",required:!0,message:"请选择出行目的",trigger:"change",type:"enum",enum:["公务","购物餐饮","看病探病","陪护","其他","上班","探亲访友","文体娱乐","上学"]}},selectList:[],currentSelect:"purpose",selectShow:!1,errorType:["message"],polyline:[],markers:[]}},computed:s({},(0,i.mapState)(["trip"])),watch:{currentSelect:function(e){if("start_markerId"!=e&&"end_markerId"!=e){var t=this.rules[e].enum,r=t.map((function(e){return{value:e,label:e}}));this.selectList=r}else switch(e){case"start_markerId":this.$u.toast("请在地图上选择起点");break;case"end_markerId":this.$u.toast("请在地图上选择终点");break}}},onLoad:function(e){this.currentTrip=this.trip[e.index],this.currentTripIndex=e.index,this.initMarkers(),console.log(this.currentTrip)},onReady:function(){this.$refs.uForm.setRules(this.rules),this.latitude=this.currentTrip.raw[0].latitude,this.longitude=this.currentTrip.raw[0].longitude,this.refreshPolyline(),d=e.createMapContext("map",this)},methods:{moveToStart:function(){d.moveToLocation({latitude:this.currentTrip.raw[0].latitude,longitude:this.currentTrip.raw[0].longitude})},clearSearch:function(){9999999999999==this.markers[this.markers.length-1].id&&this.markers.pop()},getCallout:function(e,t){return{content:e,color:t,fontSize:14,borderWidth:2,borderRadius:10,borderColor:"#fff",bgColor:"#fff",padding:5,display:"ALWAYS",textAlign:"center"}},initMarkers:function(){var e=this.$u.deepClone(this.currentTrip.raw);e.map((function(e){e.width=18,e.height=32})),e[0].callout=this.getCallout("轨迹起点","#19be6b"),e[e.length-1].callout=this.getCallout("轨迹终点","#fa3534"),this.markers=e},getRandomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)},getPolylineWithId:function(e,t){var r=[];return this.currentTrip.raw.forEach((function(n){n.id>=e&&n.id<=t&&r.push(n)})),{points:r,color:this.polyline.length<m.length?m[this.polyline.length]:this.getRandomColor(),arrowLine:!0,width:8}},refreshPolyline:function(){var e=this;this.polyline=[{points:this.currentTrip.raw,color:m[0],arrowLine:!0,width:4}],this.currentTrip.record.forEach((function(t){e.polyline.push(e.getPolylineWithId(t.start_markerId,t.end_markerId))}))},getRecordFromId:function(e){return this.currentTrip.raw.find((function(t){return t.id===e}))},getTimeFromRecord:function(e){var t=this.getRecordFromId(e);return this.$u.date(t.time,"hh:MM:ss")},chooseLocation:function(){var t=this;e.chooseLocation({success:function(e){console.log("chooseLocation Res: ",e),t.clearSearch(),t.markers.push({id:9999999999999,latitude:e.latitude,longitude:e.longitude,width:18,height:32,iconPath:"https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/markerDefault.png",callout:t.getCallout(e.name,"#303133")}),t.latitude=e.latitude,t.longitude=e.longitude},fail:function(e){console.log("chooseLocation fail: ",e)}})},markerTap:function(e){var t=this,r=e.detail.markerId;console.log("marker tap: ",r),9999999999999!=r?"start_markerId"!=this.currentSelect&&"end_markerId"!=this.currentSelect||("end_markerId"==this.currentSelect&&null!=this.model.start_markerId&&e.detail.markerId<this.model.start_markerId&&this.$u.toast("终点不得在起点之前"),"start_markerId"==this.currentSelect&&null!=this.model.end_markerId&&e.detail.markerId>this.model.end_markerId?this.$u.toast("起点不得在终点之后"):(this.model[this.currentSelect]=r,"start_markerId"==this.currentSelect&&this.markers.map((function(e){e.callout&&"路径起点"==e.callout.content&&(e.callout={})})),"end_markerId"==this.currentSelect&&this.markers.map((function(e){e.callout&&"路径终点"==e.callout.content&&(e.callout={})})),this.markers.map((function(e){if(e.id==r){var n="start_markerId"==t.currentSelect?"路径起点":"路径终点";e.callout=t.getCallout(n,"#303133")}})))):this.$u.toast("请先清除搜索结果再选点")},addRecord:function(){this.isEdit=!0,this.currentSelect="start_markerId",null!=this.currentEdit&&(this.model=this.currentTrip.record[this.currentEdit])},editRecord:function(e){this.currentEdit=e,this.addRecord()},removeRecord:function(e){this.$store.commit("removeTripRecord",{index:this.currentTripIndex,record_index:e}),this.refreshPolyline()},selectConfirm:function(e){var t=this;this.model[this.currentSelect]="",e.map((function(e,r){t.model[t.currentSelect]+=""==t.model[t.currentSelect]?e.label:"-"+e.label}))},closeForm:function(){this.model={start_markerId:null,end_markerId:null,transportation:"",purpose:""},this.isEdit=!1,this.currentEdit=null,this.initMarkers()},submit:function(){var e=this;return a(n.default.mark((function t(){var r;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e,e.$refs.uForm.validate(function(){var e=a(n.default.mark((function e(t){var i;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t&&(console.log("验证通过"),i=r.model,null!=r.currentEdit?r.$store.commit("editTripRecord",{index:r.currentTripIndex,record_index:r.currentEdit,record:{start_markerId:i.start_markerId,end_markerId:i.end_markerId,transportation:i.transportation,purpose:i.purpose}}):r.$store.commit("addTripRecord",{index:r.currentTripIndex,record:{start_markerId:i.start_markerId,end_markerId:i.end_markerId,transportation:i.transportation,purpose:i.purpose}}),r.polyline.push(r.getPolylineWithId(r.model.start_markerId,r.model.end_markerId)),r.closeForm());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})))()}}};t.default=h}).call(this,r("543d")["default"])},c677:function(e,t,r){"use strict";r.r(t);var n=r("bebf"),i=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a}},[["0b76","common/runtime","common/vendor"]]]);