(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/profile"],{"1e0c":function(e,t,n){"use strict";(function(e){n("8342");r(n("66fd"));var t=r(n("68a6"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"311b":function(e,t,n){"use strict";n.r(t);var r=n("6f96"),u=n.n(r);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=u.a},"68a6":function(e,t,n){"use strict";n.r(t);var r=n("e2be"),u=n("311b");for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);n("f40c");var a,i=n("f0c5"),c=Object(i["a"])(u["default"],r["b"],r["c"],!1,null,"4e593196",null,!1,r["a"],a);t["default"]=c.exports},"6f96":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("a34a"));function u(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,u,o,a){try{var i=e[o](a),c=i.value}catch(l){return void n(l)}i.done?t(c):Promise.resolve(c).then(r,u)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,u){var a=e.apply(t,n);function i(e){o(a,r,u,i,c,"next",e)}function c(e){o(a,r,u,i,c,"throw",e)}i(void 0)}))}}var i={data:function(){return{_id:"",model:{sex:"",age:"",education:"",occupation:"",income_min:"",income_max:"",private_car:"",construction_area:"",bicycle:"",housing_nature:"",total_people:""},schema:{basic:{title:"基本信息",props:{sex:{enum:["男","女"],label:"性别"},age:{enum:["0-12","12-18","18-25","25-35","35-45","45-55","55-65",">65"],label:"年龄"},education:{enum:["本科","初中","大专","高中或中专","小学及以下","研究生及以上"],label:"文化程度"},occupation:{enum:["办事人员和有关人员","专业技术人员","中小学生","生产、运输设备操作人员及有关人员","商业、服务业人员","其他","农、林、牧、渔、水利业生产人员","离退休人员","军人","单位负责人","大专院校学生"],label:"职业"},income:{label:"收入范围"},private_car:{enum:["0","1","2"],label:"私人小汽车"}}},family:{title:"家庭信息",props:{construction_area:{enum:["0-60","60-130",">130"],label:"建筑面积"},bicycle:{enum:["是","否"],label:"自行车"},housing_nature:{enum:["自有住宅","雇主提供","租（借）房屋","其他"],label:"住房性质"},total_people:{enum:["0","1","2","3","4","5","6","7","8"],label:"总人数"}}}},selectList:[],currentPart:"",currentSelect:"",selectShow:!1,errorType:["message"]}},computed:{rules:function(){var e={income_min:[{required:!0,message:"请输入最低收入",trigger:"change",type:"number"}],income_max:[{required:!0,message:"请输入最高收入",trigger:"change",type:"number"}]};for(var t in this.schema)for(var n in this.schema[t].props)"income"!=n&&(e[n]=[{required:!0,message:"请选择".concat(this.schema[t].props[n].label),trigger:"change",type:"enum",enum:this.schema[t].props[n].enum}]);return e}},onReady:function(){this.$refs.uForm.setRules(this.rules)},mounted:function(){var t=this;return a(r.default.mark((function n(){var u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("正在获取数据"),e.showLoading({title:"正在加载",mask:!0}),n.next=4,t.$db.collection("tx-userinfo").where("uid == $env.uid").get({getOne:!0});case 4:u=n.sent,console.log("userinfo: ",u),0!=u.result.affectedDocs&&(t._id=u.result.data._id,delete u.result.data._id,delete u.result.data.uid,t.model=u.result.data),e.hideLoading();case 8:case"end":return n.stop()}}),n)})))()},watch:{currentSelect:function(){var e=this.schema[this.currentPart].props[this.currentSelect].enum,t=e.map((function(e){return{value:e,label:e}}));this.selectList=t}},methods:{submit:function(){var t=this;return a(r.default.mark((function n(){var u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:u=t,t.$refs.uForm.validate(function(){var t=a(r.default.mark((function t(n){var o,a,i,c;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=41;break}if(console.log("验证通过"),o=u.model,e.showLoading({title:"正在保存",mask:!0}),console.log(JSON.stringify(o,null,2)),!u._id){t.next=24;break}return t.prev=6,a="_id == '".concat(u._id,"' && uid == $env.uid"),t.next=10,u.$db.collection("tx-userinfo").where(a).update(o);case 10:i=t.sent,console.log("更新个人资料成功：",i),e.hideLoading(),u.$u.toast("保存成功"),e.switchTab({url:"../trip/trip"}),t.next=22;break;case 17:t.prev=17,t.t0=t["catch"](6),e.hideLoading(),u.$u.toast("保存失败，请重试"),console.error("更新个人资料失败: ",t.t0);case 22:t.next=39;break;case 24:return t.prev=24,t.next=27,u.$db.collection("tx-userinfo").add(o);case 27:c=t.sent,console.log("创建个人资料成功：",c),e.hideLoading(),u.$u.toast("保存成功"),e.switchTab({url:"../trip/trip"}),t.next=39;break;case 34:t.prev=34,t.t1=t["catch"](24),e.hideLoading(),u.$u.toast("保存失败，请重试"),console.error("创建个人资料失败: ",t.t1);case 39:t.next=44;break;case 41:return console.log("验证失败"),e.hideLoading(),t.abrupt("return",u.$u.toast("请检查输入数据"));case 44:case"end":return t.stop()}}),t,null,[[6,17],[24,34]])})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return n.stop()}}),n)})))()},selectConfirm:function(e){var t=this;this.model[this.currentSelect]="",e.map((function(e,n){t.model[t.currentSelect]+=""==t.model[t.currentSelect]?e.label:"-"+e.label}))}}};t.default=i}).call(this,n("543d")["default"])},d52d:function(e,t,n){},e2be:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={uForm:function(){return n.e("node-modules/uview-ui/components/u-form/u-form").then(n.bind(null,"7539"))},uFormItem:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(n.bind(null,"4ae2"))},uInput:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-input/u-input")]).then(n.bind(null,"531f"))},uButton:function(){return n.e("node-modules/uview-ui/components/u-button/u-button").then(n.bind(null,"f9a8"))},uSelect:function(){return n.e("node-modules/uview-ui/components/u-select/u-select").then(n.bind(null,"97b9"))}},u=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t,n,r){var u=arguments[arguments.length-1].currentTarget.dataset,o=u.eventParams||u["event-params"];n=o.item_idx,r=o.part_idx;e.selectShow=!0,e.currentSelect=n,e.currentPart=r})},o=[]},f40c:function(e,t,n){"use strict";var r=n("d52d"),u=n.n(r);u.a}},[["1e0c","common/runtime","common/vendor"]]]);